server_name: "{{ MATRIX_SERVER_NAME }}"
pid_file: /data/homeserver.pid
report_stats: false
public_baseurl: "https://{{ MATRIX_SERVER_NAME }}/"

listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']
    resources:
      - names: [client, federation]
        compress: false

database:
  name: psycopg2
  txn_limit: 10000
  args:
    user: "{{ POSTGRES_USER }}"
    password: "{{ POSTGRES_PASSWORD }}"
    database: "{{ POSTGRES_DB }}"
    host: "postgres"
    port: 5432
    cp_min: 5
    cp_max: 10

enable_registration: true
enable_registration_without_verification: true
registration_shared_secret: "{{ SYNAPSE_REGISTRATION_SHARED_SECRET }}"
registration_requires_token: false

macaroon_secret_key: "{{ SYNAPSE_MACAROON_SECRET_KEY }}"
form_secret: "{{ SYNAPSE_FORM_SECRET }}"
signing_key: "{{ SYNAPSE_SIGNING_KEY }}"

trusted_key_servers:
  - server_name: "matrix.org"

# LiveKit & Turn (WebRTC)
turn_uris:
  - "turn:{{ RTC_DOMAIN }}:3478?transport=udp"
  - "turn:{{ RTC_DOMAIN }}:3478?transport=tcp"
turn_shared_secret: "{{ TURN_SHARED_SECRET }}"
turn_user_lifetime: 86400000
turn_allow_guests: true

experimental_features:
  msc3981:
    enabled: true

# Media
media_store_path: /data/media_store
uploads_path: /data/uploads
max_upload_size: 100M
url_preview_enabled: true
url_preview_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '172.16.0.0/12'
  - '192.168.0.0/16'
  - '100.64.0.0/10'
  - '169.254.0.0/16'
  - '::1/128'
  - 'fe80::/64'
  - 'fc00::/7'
